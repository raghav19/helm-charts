---
suite: DaemonSet TXT
templates:
  - daemonset-txt.yaml
release:
  name: utesting
  namespace: utestingnamespace
tests:
  - it: Default values
    asserts:
      - isKind:
          of: DaemonSet
      - isAPIVersion:
          of: apps/v1
      - hasDocuments:
          count: 1
      - equal:
          path: metadata.name
          value: ta-txt
      - equal:
          path: metadata.namespace
          value: utestingnamespace
      - equal:
          path: spec.template.spec.serviceAccountName
          value: isecl
      - equal:
          path: spec.template.spec.containers[0].name
          value: ta
      - equal:
          path: spec.template.spec.containers[0].envFrom[0].configMapRef.name
          value: ta
      - equal:
          path: spec.template.spec.containers[0].ports[0].containerPort
          value: 1443
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[0].name
          value: ta-logs
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[1].name
          value: ta-config
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[2].name
          value: ta-hostname
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[3].name
          value: ta-hosts
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[4].name
          value: ta-host-os
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[5].name
          value: ta-mem
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[6].name
          value: ta-acpi
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[7].name
          value: ta-secrets
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[8].name
          value: tpmrm
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[8].mountPath
          value: /dev/tpmrm0
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[9].name
          value: uefi
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[9].mountPath
          value: /sys/firmware/dmi/tables/DMI
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[10].name
          value: wla-config-volume
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[10].mountPath
          value: /etc/workload-agent/
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[11].name
          value: txt-stat
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[11].mountPath
          value: /usr/sbin/txt-stat
      - equal:
          path: spec.template.spec.volumes[0].name
          value: ta-logs
      - equal:
          path: spec.template.spec.volumes[1].name
          value: ta-config
      - equal:
          path: spec.template.spec.volumes[2].name
          value: ta-hostname
      - equal:
          path: spec.template.spec.volumes[3].name
          value: ta-hosts
      - equal:
          path: spec.template.spec.volumes[4].name
          value: ta-host-os
      - equal:
          path: spec.template.spec.volumes[5].name
          value: ta-mem
      - equal:
          path: spec.template.spec.volumes[5].hostPath.path
          value: /dev/mem
      - equal:
          path: spec.template.spec.volumes[6].name
          value: ta-acpi
      - equal:
          path: spec.template.spec.volumes[6].hostPath.path
          value: /sys/firmware/acpi/tables/TPM2
      - equal:
          path: spec.template.spec.volumes[7].name
          value: tpmrm
      - equal:
          path: spec.template.spec.volumes[7].hostPath.path
          value: /dev/tpmrm0
      - equal:
          path: spec.template.spec.volumes[8].name
          value: uefi
      - equal:
          path: spec.template.spec.volumes[8].hostPath.path
          value: /sys/firmware/dmi/tables/DMI
      - equal:
          path: spec.template.spec.volumes[9].name
          value: wla-config-volume
      - equal:
          path: spec.template.spec.volumes[9].hostPath.path
          value: /etc/workload-agent
      - equal:
          path: spec.template.spec.volumes[10].name
          value: txt-stat
      - equal:
          path: spec.template.spec.volumes[10].hostPath.path
          value: /usr/sbin/txt-stat
  - it:   Overridden Values
    set:
      nameOverride: ta-overridden-name
    asserts:
      - equal:
          path: metadata.name
          value: ta-overridden-name-txt
      - equal:
          path: spec.template.spec.containers[0].name
          value: ta-overridden-name
      - equal:
          path: spec.template.spec.containers[0].envFrom[0].configMapRef.name
          value: ta-overridden-name
      - equal:
          path: spec.template.spec.containers[0].ports[0].containerPort
          value: 1443
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[0].name
          value: ta-overridden-name-logs
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[1].name
          value: ta-overridden-name-config
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[2].name
          value: ta-overridden-name-hostname
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[3].name
          value: ta-overridden-name-hosts
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[4].name
          value: ta-overridden-name-host-os
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[5].name
          value: ta-overridden-name-mem
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[6].name
          value: ta-overridden-name-acpi
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[7].name
          value: ta-overridden-name-secrets
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[8].name
          value: tpmrm
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[8].mountPath
          value: /dev/tpmrm0
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[9].name
          value: uefi
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[9].mountPath
          value: /sys/firmware/dmi/tables/DMI
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[10].name
          value: wla-config-volume
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[10].mountPath
          value: /etc/workload-agent/
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[11].name
          value: txt-stat
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[11].mountPath
          value: /usr/sbin/txt-stat
      - equal:
          path: spec.template.spec.volumes[0].name
          value: ta-overridden-name-logs
      - equal:
          path: spec.template.spec.volumes[1].name
          value: ta-overridden-name-config
      - equal:
          path: spec.template.spec.volumes[2].name
          value: ta-overridden-name-hostname
      - equal:
          path: spec.template.spec.volumes[3].name
          value: ta-overridden-name-hosts
      - equal:
          path: spec.template.spec.volumes[4].name
          value: ta-overridden-name-host-os
      - equal:
          path: spec.template.spec.volumes[5].name
          value: ta-overridden-name-mem
      - equal:
          path: spec.template.spec.volumes[5].hostPath.path
          value: /dev/mem
      - equal:
          path: spec.template.spec.volumes[6].name
          value: ta-overridden-name-acpi
      - equal:
          path: spec.template.spec.volumes[6].hostPath.path
          value: /sys/firmware/acpi/tables/TPM2
      - equal:
          path: spec.template.spec.volumes[7].name
          value: tpmrm
      - equal:
          path: spec.template.spec.volumes[7].hostPath.path
          value: /dev/tpmrm0
      - equal:
          path: spec.template.spec.volumes[8].name
          value: uefi
      - equal:
          path: spec.template.spec.volumes[8].hostPath.path
          value: /sys/firmware/dmi/tables/DMI
      - equal:
          path: spec.template.spec.volumes[9].name
          value: wla-config-volume
      - equal:
          path: spec.template.spec.volumes[9].hostPath.path
          value: /etc/workload-agent
      - equal:
          path: spec.template.spec.volumes[10].name
          value: txt-stat
      - equal:
          path: spec.template.spec.volumes[10].hostPath.path
          value: /usr/sbin/txt-stat
